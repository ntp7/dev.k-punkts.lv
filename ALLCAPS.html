<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 0; }
h1 {
  background: linear-gradient(to right, #c94857, #411c20);
  color: white; padding: 10px 20px; font-size: 24px;
  display: flex; justify-content: space-between; align-items: center; margin: 0;
}
h1 img { height: 50px; }
table { width: 100%; border-collapse: collapse; font-size: 18px; }
th, td { padding: 10px; border-bottom: 1px solid #ddd; }
th { background-color: #f2f2f2; }
tr:hover { background-color: #f5f5f5; }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-analytics.js";
import firebaseConfig from './firebaseconfig.js';

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
getAnalytics(app);

document.addEventListener('DOMContentLoaded', async () => {
  const tableBody = document.querySelector('#participants-table tbody');
  let totalParticipants = 0, totalEur = 0, totalWomen = 0, totalMen = 0;

  try {
    const q = query(collection(db, 'pieteikums100km2025'), orderBy('submissionTime'));
    const querySnapshot = await getDocs(q);
    let index = 1;

    querySnapshot.forEach((docSnapshot) => {
      const data = docSnapshot.data();
      if (data.hide) return;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${index++}</td>
        <td>${data.vards ? data.vards.toUpperCase() : ''}</td>
        <td>${data.uzvards ? data.uzvards.toUpperCase() : ''}</td>
        <td>${data.dzimums}</td>
        <td>${data.epasts}</td>
        <td>${data.telefons}</td>
        <td>${data.birthday}</td>
        <td>${data.country}</td>
        <td>${data.ediens}</td>
        <td>${data.ediens2}</td>
        <td>${data.sekot}</td>
        <td>${data.atlaide}</td>
        <td>${data.komentars}</td>
        <td>${data.news}</td>
        <td>${new Date(data.submissionTime).toLocaleString()}</td>
        <td style="text-align:center">${data.samaksa}</td>
      `;
      totalParticipants++;
      totalEur += data.samaksa;
      if (data.dzimums === "virietis") totalMen++;
      if (data.dzimums === "sieviete") totalWomen++;
      tableBody.appendChild(row);
    });

    document.getElementById('value1').textContent = totalParticipants;
    document.getElementById('value2').textContent = totalEur + 24 + 30;
    document.getElementById('value3').textContent = totalWomen;
    document.getElementById('value4').textContent = totalMen;
  } catch (error) {
    console.error("Error getting documents: ", error);
  }
});
</script>
</head>

<body>
<h1>
  <span>Dalībnieku saraksts <span style="font-size:18px;color:#ffa7a7;padding-left:10px;">K-100 2025</span></span>
  <div>
    <span>Dalībnieku skaits: <span id="value1"></span></span> |
    <span>Kopā EUR: <span id="value2"></span></span> |
    <span>Sievietes: <span id="value3"></span></span> |
    <span>Vīrieši: <span id="value4"></span></span>
  </div>
  <img src="logo.png" alt="Kpunkts Logo">
</h1>

<table id="participants-table">
  <thead>
    <tr>
      <th>Nr.</th><th>Vārds</th><th>Uzvārds</th><th>Dzimums</th><th>Epasts</th><th>Telefons</th>
      <th>Dzimšanas diena</th><th>Valsts</th><th>Ēdiens</th><th>Ēdiens2</th><th>Sekot</th>
      <th>Atlaide</th><th>Komentārs</th><th>News</th><th>Reģistrācijas laiks</th><th>Samaksa</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</body>
</html>
